<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ルミナスシャドウズ・ワンオラクル</title>
  <meta name="description" content="Luminous Shadows 裏面＋反転アニメーション対応の1枚引きツール。cards.jsに全78枚の意味を収録。" />
  <style>
    :root{ --bg:#faf8f4; --ink:#222; --muted:#6b6b6b; --edge:#e8e2d9; --accent:#2f7d6d;}
    *{box-sizing:border-box}
    body { font-family: system-ui, -apple-system, 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
           background: var(--bg); color: var(--ink); margin: 0; text-align: center;}
    header{padding:28px 16px 10px}
    h1 { font-size: 1.3rem; margin: 0 0 6px; letter-spacing:.06em;}
    p.lead{color:var(--muted); margin:0}
    .card-container { perspective: 1200px; display: inline-block; margin-top: 18px; }
    .card { width: 260px; height: 420px; position: relative; transform-style: preserve-3d; transition: transform 0.8s ease;
            border-radius: 14px; box-shadow: 0 8px 20px rgba(0,0,0,0.18); }
    .card.flipped { transform: rotateY(180deg); }
    .card-face { position: absolute; inset:0; backface-visibility: hidden; border-radius: 14px; overflow: hidden; background:#fff; }
    .card-face img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card-front { transform: rotateY(180deg); background: #fff; }
    .controls{display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; margin:12px 0 4px}
    .controls label{font-size:12px;color:var(--muted)}
    .btn { background: var(--accent); color: #fff; border: none; padding: 10px 18px; border-radius: 999px; cursor: pointer; font-size: .95rem; }
    .btn.secondary{background:#111}
    .btn:hover { filter: brightness(1.05); }
    .text { max-width: 520px; margin: 16px auto 28px; text-align: left; line-height: 1.8; }
    .muted{color:var(--muted)}
    footer{color:var(--muted); font-size:12px; padding:20px 0 28px}
  </style>
</head>
<body>
  <header>
    <h1>タロット占い｜ルミナスシャドウズ ワンオラクル</h1>
    <p class="lead">心を落ち着けて、知りたいことを思い浮かべてください。</p>
  </header>

  <div class="controls">
    <label><input id="allowRev" type="checkbox" checked> 逆位置を出す</label>
    <button class="btn" id="draw">カードを引く</button>
    <button class="btn secondary" id="again">もう一度</button>
  </div>

  <div class="card-container">
    <div class="card" id="tarotCard">
      <div class="card-face card-back">
        <img id="back-image" src="images/back.jpg" alt="Luminous Shadows カード裏面">
      </div>
      <div class="card-face card-front">
        <img id="card-image" src="images/major_00.jpg" alt="タロットカード表面">
      </div>
    </div>
  </div>

  <div class="text">
    <h3 id="card-name"></h3>
    <p class="muted" id="posture"></p>
    <p id="card-meaning"></p>
  </div>

  <footer>© Luminous Shadows by 華印レン </footer>

  <script src="cards.js"></script>
  <script>
    const el = {
      draw: document.getElementById('draw'),
      again: document.getElementById('again'),
      card: document.getElementById('tarotCard'),
      backImg: document.getElementById('back-image'),
      img: document.getElementById('card-image'),
      name: document.getElementById('card-name'),
      posture: document.getElementById('posture'),
      meaning: document.getElementById('card-meaning'),
      allowRev: document.getElementById('allowRev')
    };

    // 裏面画像ローダー（大小文字・拡張子のゆらぎに対応）
    (function ensureBackImage(){
      const candidates = [
        'images/back.jpg', 'images/back.jpeg', 'images/back.png',
        'images/Back.jpg', 'images/Back.jpeg', 'images/Back.png',
        'images/LuminousShadows-back.jpg', 'images/LuminousShadows-back.png'
      ];
      let i = 0;
      function tryNext(){
        if(i >= candidates.length){ return; }
        const src = candidates[i++];
        const test = new Image();
        test.onload = ()=>{ el.backImg.src = src; };
        test.onerror = tryNext;
        test.src = src + '?v=' + Date.now();
      }
      tryNext();
    })();

    function drawCard(){
      const idx = Math.floor(Math.random() * cards.length);
      const card = cards[idx];
      const reversed = el.allowRev.checked ? Math.random() < 0.5 : false;

      el.card.classList.add('flipped'); // 裏→表に反転
      setTimeout(()=>{
        el.img.onerror = () => { el.img.onerror = null; el.img.src = 'images/back.jpg'; };
        el.img.src = card.image || 'images/back.jpg';
        el.name.textContent = card.name + (reversed ? '（逆位置）' : '');
        el.posture.textContent = reversed ? '逆位置' : '正位置';
        el.meaning.textContent = reversed ? card.reversed : card.upright;
      }, 350);
    }

    el.draw.addEventListener('click', drawCard);
    el.again.addEventListener('click', ()=>{
      el.card.classList.remove('flipped'); // 表→裏に戻す
      setTimeout(drawCard, 220);
    });
  </script>
</body>
</html>
